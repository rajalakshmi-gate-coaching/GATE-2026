<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GATE 2026 - Microbiology Mock (12-Dec)</title>
    
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/auth.js"></script>
    
    <script type="module">
        // Import Firebase Logic
        import { db, collection, addDoc } from "../js/firebase_config.js";

        // Expose functions to global window object so HTML buttons can see them
        window.loadQ = loadQ;
        window.saveAnswer = saveAnswer;
        window.saveNext = saveNext;
        window.markReview = markReview;
        window.nav = nav;
        window.updatePalette = updatePalette;
        window.jumpTo = jumpTo;
        window.showReviewModal = showReviewModal;

        // --- HELPER TO CONVERT 0,1,2 TO A,B,C ---
        function getLabel(type, val) {
            if (val === undefined || val === null) return "Not Answered";
            if (type === 'NAT') return val;
            const labels = ['A', 'B', 'C', 'D', 'E', 'F'];
            if (type === 'MSQ' && Array.isArray(val)) return val.sort().map(v => labels[v]).join(', ');
            return labels[val];
        }

        // --- CLOUD SUBMIT LOGIC ---
        window.confirmSubmit = async function() {
            clearInterval(timerInterval);
            document.getElementById('reviewModal').style.display = "none";
            
            const stats = calculateScore();
            const uid = localStorage.getItem("REC_USER_ID") || "GUEST";
            
            // 1. GENERATE DETAILED ANALYSIS FOR CLOUD
            const analysisLog = questions.map(q => {
                const userVal = responses[q.id];
                return {
                    id: q.id,
                    question: q.question,
                    type: q.type,
                    marks: q.marks,
                    student_answer: getLabel(q.type, userVal),
                    correct_answer: getLabel(q.type, q.correct),
                    is_correct: checkCorrect(q, userVal),
                    options: q.options || [] 
                };
            });

            document.body.innerHTML = `
                <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; background:#f4f4f4;">
                    <h2 style="color:#003366;">ðŸš€ Uploading Full Analysis to Cloud...</h2>
                    <p>Saving response data and question bank...</p>
                </div>
            `;

            try {
                // 2. SEND TO FIREBASE
                const docRef = await addDoc(collection(db, "student_responses"), {
                    student_id: uid,
                    exam_name: EXAM_NAME,
                    score: stats.totalScore,
                    total_marks: questions.reduce((a,b)=>a+b.marks,0),
                    date: new Date().toISOString(),
                    attempted: stats.attemptCount,
                    correct: stats.correctCount,
                    detailed_analysis: JSON.stringify(analysisLog) 
                });

                // 3. SUCCESS SCREEN
                document.body.innerHTML = `
                    <div style="text-align:center; padding:50px; background:#f4f4f4; height:100vh;">
                        <div style="background:white; padding:40px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1); display:inline-block;">
                            <h1 style="color:green; font-size:2.5rem;">âœ” Analysis Saved!</h1>
                            <p>Faculty can now download your full answer sheet from the cloud.</p>
                            <hr style="margin:20px 0;">
                            <div style="font-size:3rem; font-weight:bold; color:#003366;">
                                ${stats.totalScore} / ${questions.reduce((a,b)=>a+b.marks,0)}
                            </div>
                            <br>
                            <button onclick="window.location.href='../index.html'" style="padding:12px 25px; background:#003366; color:white; border:none; border-radius:5px; cursor:pointer;">Return to Dashboard</button>
                        </div>
                    </div>
                `;
            } catch (e) {
                console.error("Error:", e);
                alert("Cloud Error. Please try again.");
                location.reload(); 
            }
        }

        // Helper for accuracy check
        function checkCorrect(q, userAns) {
            if (userAns === undefined) return false;
            if (q.type === 'MCQ') return userAns === q.correct;
            if (q.type === 'MSQ') return JSON.stringify(userAns.sort()) === JSON.stringify(q.correct.sort());
            if (q.type === 'NAT') {
                const tolerance = 1e-6;
                return Math.abs(userAns - q.correct) <= (q.range || tolerance);
            }
            return false;
        }
    </script>

    <script>
        // Security Check
        if (typeof requireAuth === 'function') requireAuth();
    </script>

    <style>
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; margin: 5% auto; padding: 20px; border-radius: 8px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto; }
        .review-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 8px; margin: 20px 0; }
        .review-item { padding: 8px; text-align: center; border: 1px solid #ccc; border-radius: 4px; font-size: 0.85rem; cursor: pointer; }
        .review-item:hover { background-color: #f0f0f0; }
        .review-ans { background-color: #d4edda; border-color: #c3e6cb; }
        .review-miss { background-color: #f8d7da; border-color: #f5c6cb; }
        
        body { display: flex; flex-direction: column; height: 100vh; overflow: hidden; background: #f4f4f4; }
        header { background: #003366; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        .timer { font-size: 1.5rem; font-weight: bold; background: #FFCC00; color: black; padding: 5px 15px; border-radius: 4px; }
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .question-area { flex: 3; padding: 40px; overflow-y: auto; background: white; }
        .q-header { display: flex; justify-content: space-between; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
        .q-text { font-size: 1.2rem; margin-bottom: 25px; white-space: pre-wrap; }
        .options label { display: block; padding: 15px; margin: 10px 0; background: #f8f9fa; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; }
        .options label:hover { background: #e2e6ea; border-color: #003366; }
        .options input { margin-right: 15px; transform: scale(1.2); }
        .nat-input { padding: 10px; font-size: 1.2rem; width: 200px; border: 2px solid #003366; border-radius: 4px; }
        .sidebar { flex: 1; background: #e9ecef; border-left: 1px solid #ccc; display: flex; flex-direction: column; max-width: 350px; }
        .user-panel { padding: 15px; background: white; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 10px; }
        .legend { padding: 10px; font-size: 0.8rem; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; background: white; border-bottom: 1px solid #ddd; }
        .legend span { display: inline-block; width: 15px; height: 15px; margin-right: 8px; border-radius: 3px; border: 1px solid #ccc; }
        .palette { flex: 1; padding: 15px; overflow-y: auto; display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; align-content: start; }
        .p-btn { padding: 10px 0; background: white; border: 1px solid #ccc; cursor: pointer; text-align: center; border-radius: 4px; font-weight: bold; }
        .p-btn.active { border: 2px solid #003366; transform: scale(1.05); }
        .p-btn.answered { background: #28a745; color: white; border-color: #28a745; }
        .p-btn.visited { background: #dc3545; color: white; border-color: #dc3545; }
        .p-btn.review { background: #007bff; color: white; border-color: #007bff; }
        .p-btn.review-ans { background: #6610f2; color: white; border-color: #6610f2; }
        .footer { padding: 15px; background: white; border-top: 1px solid #ccc; display: flex; justify-content: space-between; }
        .btn { padding: 10px 25px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; }
    </style>
</head>
<body>

    <header>
        <div><strong>GATE 2026</strong> | Microbiology Mock (12-Dec)</div>
        <div class="timer" id="timer-display">90:00</div>
    </header>

    <div class="main-container">
        <div class="question-area">
            <div class="q-header">
                <div><strong>Question <span id="q-num">1</span></strong></div>
                <div style="text-align: right;">
                    <span id="q-type" style="background:#ddd; color:black; padding:4px 10px; border-radius:4px; font-size:0.9rem;">MCQ</span>
                    <span id="q-marks" style="color: green; font-weight: bold; margin-left:10px;">+1 Mark</span>
                </div>
            </div>
            <div class="q-text" id="q-text">Loading...</div>
            <div class="options" id="options-box"></div>
        </div>

        <div class="sidebar">
            <div class="user-panel">
                <div style="width:40px; height:40px; background:#003366; color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">U</div>
                <div>
                    <div style="font-weight:bold;" id="disp-user">Student</div>
                    <div style="font-size:0.8rem; color:#555;">ID: <span id="disp-id">...</span></div>
                </div>
            </div>
            <div class="legend">
                <div><span style="background:#28a745;"></span>Answered</div>
                <div><span style="background:#dc3545;"></span>Not Ans</div>
                <div><span style="background:#007bff;"></span>Review</div>
                <div><span style="background:white;"></span>Not Visited</div>
            </div>
            <div class="palette" id="palette-box"></div>
            <div style="padding:15px;">
                <button class="btn" style="background:#003366; width:100%;" onclick="showReviewModal()">SUBMIT EXAM</button>
            </div>
        </div>
    </div>

    <div class="footer">
        <button class="btn" style="background:#6c757d;" onclick="nav(-1)">Previous</button>
        <button class="btn" style="background:#ffc107; color:black;" onclick="markReview()">Mark for Review</button>
        <button class="btn" style="background:#28a745;" onclick="saveNext()">Save & Next</button>
    </div>

    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <h2 style="color:#003366;">Submission Review</h2>
            <p>Please check your attempts before final submission.</p>
            <div class="review-grid" id="review-grid-content"></div>
            <div style="text-align:right; margin-top:20px;">
                <button class="btn" style="background:#6c757d;" onclick="document.getElementById('reviewModal').style.display='none'">Back to Test</button>
                <button class="btn" style="background:#dc3545;" onclick="confirmSubmit()">Confirm Submit</button>
            </div>
        </div>
    </div>

    <script>
        // ================= DATA & QUESTIONS =================
        const TOTAL_TIME = 90;
        const EXAM_NAME = "GATE2026_Microbio_12Dec";
        
        // --- PASTE YOUR 75 QUESTIONS HERE ---
        const questions = [
  {"id":1,"type":"MCQ","marks":1,"question":"Sterilization is defined as the process that:","options":["Reduces microbial load to safe levels","Eliminates all forms of microbial life including spores","Kills only vegetative cells","Inhibits microbial growth temporarily"],"correct":1},
  {"id":2,"type":"MCQ","marks":1,"question":"Disinfection primarily refers to:","options":["Complete removal of all microbes including spores","Elimination of pathogenic microbes on inanimate objects (spores may survive)","Removal of microbes from living tissue only","Removal of dirt and organic matter only"],"correct":1},
  {"id":3,"type":"MCQ","marks":1,"question":"The most resistant microbial form to chemical disinfectants is generally:","options":["Vegetative bacteria","Enveloped viruses","Bacterial endospores","Fungi (yeast)"],"correct":2},
  {"id":4,"type":"MCQ","marks":1,"question":"The standard condition for moist heat sterilization in an autoclave is:","options":["100Â°C for 30 min","121Â°C for 15 min at ~15 psi","160Â°C for 2 hours","70% ethanol for 10 min"],"correct":1},
  {"id":5,"type":"MCQ","marks":1,"question":"Dry heat sterilization is commonly performed using:","options":["Autoclave","Hot air oven","Membrane filter","UV lamp"],"correct":1},
  {"id":6,"type":"MCQ","marks":1,"question":"The D-value in microbial death kinetics refers to:","options":["Time required to kill 100% of organisms","Time required to reduce population by 90% at a given condition","Temperature increase needed to kill microbes","Time required to double the microbial population"],"correct":1},
  {"id":7,"type":"MCQ","marks":1,"question":"The Z-value refers to the temperature change required to:","options":["Change the D-value by a factor of 10","Kill 90% of microbes","Increase microbial growth by 10-fold","Destroy endotoxins"],"correct":0},
  {"id":8,"type":"MCQ","marks":1,"question":"A biological indicator commonly used to validate autoclave sterilization is:","options":["Escherichia coli spores","Bacillus/Geobacillus stearothermophilus spores","Staphylococcus aureus cells","Candida albicans cells"],"correct":1},
  {"id":9,"type":"MCQ","marks":1,"question":"Which of the following is an example of a high-level disinfectant/chemical sterilant?","options":["Sodium chloride","Glutaraldehyde","Glycerol","Starch"],"correct":1},
  {"id":10,"type":"MCQ","marks":1,"question":"70% ethanol is more effective than 100% ethanol because:","options":["It evaporates faster","Water facilitates protein denaturation and penetration","It is non-flammable","It oxidizes cell walls more strongly"],"correct":1},
  {"id":11,"type":"MCQ","marks":1,"question":"The primary target of UV radiation (254 nm) in microbes is:","options":["Cell membrane lipids","DNA (pyrimidine dimers)","Ribosomes","Peptidoglycan"],"correct":1},
  {"id":12,"type":"MCQ","marks":1,"question":"Which factor most reduces the effectiveness of many disinfectants?","options":["Low microbial load","Presence of organic matter","Higher temperature","Longer contact time"],"correct":1},
  {"id":13,"type":"MCQ","marks":1,"question":"Pasteurization is best described as:","options":["Sterilization by boiling","Disinfection method reducing pathogens in liquids without sterilizing","Dry heat sterilization","Removal of microbes by filtration"],"correct":1},
  {"id":14,"type":"MCQ","marks":1,"question":"HEPA filtration is most effective for removing particles of size around:","options":["10 Î¼m","0.3 Î¼m","0.03 Î¼m","3 mm"],"correct":1},
  {"id":15,"type":"MCQ","marks":1,"question":"The major energetic product of glycolysis (per glucose) under aerobic conditions is:","options":["2 ATP and 2 NADH","4 ATP and 4 NADH","2 ATP and 2 FADH2","0 ATP and 2 NADH"],"correct":0},
  {"id":16,"type":"MCQ","marks":1,"question":"The enzyme that catalyzes the committed step of glycolysis is:","options":["Hexokinase","Phosphofructokinase-1 (PFK-1)","Pyruvate kinase","Aldolase"],"correct":1},
  {"id":17,"type":"MCQ","marks":1,"question":"In glycolysis, fructose-1,6-bisphosphate is cleaved to form:","options":["Glucose-6-phosphate and fructose-6-phosphate","Two molecules of pyruvate","Glyceraldehyde-3-phosphate and dihydroxyacetone phosphate","Acetyl-CoA and CO2"],"correct":2},
  {"id":18,"type":"MCQ","marks":1,"question":"Substrate-level phosphorylation in glycolysis occurs at the steps catalyzed by:","options":["Hexokinase and PFK-1","GAPDH and enolase","Phosphoglycerate kinase and pyruvate kinase","Aldolase and triose phosphate isomerase"],"correct":2},
  {"id":19,"type":"MCQ","marks":1,"question":"The TCA cycle occurs in bacteria primarily in the:","options":["Nucleus","Mitochondria","Cytosol","Cytosol with enzymes associated to cytosolic side of plasma membrane"],"correct":3},
  {"id":20,"type":"MCQ","marks":1,"question":"One turn of the TCA cycle (per acetyl-CoA) produces:","options":["1 NADH, 1 FADH2, 1 ATP (GTP), 1 CO2","2 NADH, 1 FADH2, 1 ATP (GTP), 2 CO2","3 NADH, 0 FADH2, 1 ATP, 2 CO2","2 NADH, 2 FADH2, 1 ATP, 2 CO2"],"correct":1},
  {"id":21,"type":"MCQ","marks":2,"question":"A culture contains 10^6 spores. After autoclaving for one D-value time under the same conditions, the expected survivors are:","options":["10^6","10^5","10^4","0"],"correct":1},
  {"id":22,"type":"MCQ","marks":2,"question":"The main reason moist heat sterilization is more effective than dry heat at the same temperature is:","options":["Moist heat causes oxidation of cell walls","Moist heat penetrates better and denatures proteins efficiently","Dry heat cannot kill spores","Moist heat is always applied under vacuum"],"correct":1},
  {"id":23,"type":"MCQ","marks":2,"question":"Which sterilization method is most suitable for heat-labile antibiotic solutions?","options":["Autoclaving","Hot air oven","Membrane filtration (0.22 Î¼m)","Incineration"],"correct":2},
  {"id":24,"type":"MCQ","marks":2,"question":"If Z-value is 10Â°C, increasing the temperature from 121Â°C to 131Â°C will change D-value by a factor of:","options":["2","10","1/10","100"],"correct":2},
  {"id":25,"type":"MCQ","marks":2,"question":"A 6-log reduction means microbial population is reduced by a factor of:","options":["10^2","10^3","10^6","6"],"correct":2},
  {"id":26,"type":"MCQ","marks":2,"question":"Which statement best distinguishes sanitization from disinfection?","options":["Sanitization eliminates spores; disinfection does not","Sanitization reduces microbial counts to public health standards; disinfection targets pathogens","Sanitization is only for living tissues","Disinfection is only for food industry"],"correct":1},
  {"id":27,"type":"MCQ","marks":2,"question":"The key regulatory step that produces the largest negative Î”G in glycolysis is catalyzed by:","options":["Phosphoglycerate kinase","PFK-1","Triose phosphate isomerase","Enolase"],"correct":1},
  {"id":28,"type":"MCQ","marks":2,"question":"In many bacteria, the enzyme complex converting pyruvate to acetyl-CoA is:","options":["Pyruvate dehydrogenase complex","Lactate dehydrogenase","Pyruvate carboxylase","Alcohol dehydrogenase"],"correct":0},
  {"id":29,"type":"MCQ","marks":2,"question":"A mutation knocking out phosphofructokinase (PFK-1) will directly block formation of:","options":["Glucose-6-phosphate","Fructose-1,6-bisphosphate","Pyruvate","Acetyl-CoA"],"correct":1},
  {"id":30,"type":"MCQ","marks":2,"question":"Which pair of TCA cycle reactions directly produces reduced cofactors?","options":["Citrate synthase and aconitase","Isocitrate dehydrogenase and Î±-ketoglutarate dehydrogenase","Succinate thiokinase and fumarase","Malate dehydrogenase and citrate synthase"],"correct":1},
  {"id":31,"type":"MCQ","marks":2,"question":"Which statement about spores is correct?","options":["Spores are metabolically active forms","Spores are killed easily by UV radiation","Spores have high resistance to heat and chemicals due to core dehydration and protective layers","Spores are produced by all bacteria"],"correct":2},
  {"id":32,"type":"MCQ","marks":2,"question":"In glycolysis, the net ATP yield per glucose (substrate-level phosphorylation) is:","options":["1","2","3","4"],"correct":1},
  {"id":33,"type":"MCQ","marks":2,"question":"The immediate electron acceptor for NADH produced in glycolysis during aerobic respiration in bacteria is typically:","options":["O2 directly","Cytochrome c","NADH dehydrogenase/ETC components","FAD"],"correct":2},
  {"id":34,"type":"MCQ","marks":2,"question":"A disinfectant that acts by strong oxidation and is widely used for water treatment is:","options":["Chlorine","Glycerol","Peptone","Agar"],"correct":0},
  {"id":35,"type":"MCQ","marks":2,"question":"Which statement is correct for TCA cycle in many bacteria under anaerobic conditions?","options":["It always runs as a complete oxidative cycle","It may operate as a branched pathway to supply biosynthetic precursors","It is absent in all anaerobes","It produces ATP only by oxidative phosphorylation"],"correct":1},
  {"id":36,"type":"MSQ","marks":1,"question":"Which of the following are methods of sterilization?","options":["Autoclaving","Hot air oven","Pasteurization","Membrane filtration (0.22 Î¼m)"],"correct":[0,1,3]},
  {"id":37,"type":"MSQ","marks":1,"question":"Which factors generally increase the effectiveness of chemical disinfection?","options":["Higher concentration of disinfectant","Longer contact time","Presence of organic matter","Higher temperature (within stability limits)"],"correct":[0,1,3]},
  {"id":38,"type":"MSQ","marks":1,"question":"Which microbes are typically more resistant to disinfectants?","options":["Bacterial endospores","Mycobacteria","Enveloped viruses","Protozoan cysts"],"correct":[0,1,3]},
  {"id":39,"type":"MSQ","marks":1,"question":"Which statements about autoclaving are correct?","options":["It uses saturated steam under pressure","It is a form of dry heat sterilization","It denatures proteins efficiently","It is ineffective against spores"],"correct":[0,2]},
  {"id":40,"type":"MSQ","marks":1,"question":"Which are correct about UV disinfection?","options":["It has poor penetration","It forms thymine dimers in DNA","It is suitable for sterilizing large volumes of opaque liquids","Its effectiveness depends on exposure time and distance"],"correct":[0,1,3]},
  {"id":41,"type":"MSQ","marks":1,"question":"Which steps of glycolysis consume ATP?","options":["Glucose â†’ glucose-6-phosphate","Fructose-6-phosphate â†’ fructose-1,6-bisphosphate","1,3-BPG â†’ 3-PG","PEP â†’ pyruvate"],"correct":[0,1]},
  {"id":42,"type":"MSQ","marks":1,"question":"Which steps in glycolysis directly produce NADH?","options":["Hexokinase","Glyceraldehyde-3-phosphate dehydrogenase","Enolase","Pyruvate kinase"],"correct":[1]},
  {"id":43,"type":"MSQ","marks":1,"question":"Which enzymes of the TCA cycle produce NADH?","options":["Isocitrate dehydrogenase","Î±-Ketoglutarate dehydrogenase","Succinate dehydrogenase","Malate dehydrogenase"],"correct":[0,1,3]},
  {"id":44,"type":"MSQ","marks":1,"question":"Which of the following are reduced cofactors generated in one turn of the TCA cycle (per acetyl-CoA)?","options":["NADH","FADH2","NADPH","FMNH2"],"correct":[0,1]},
  {"id":45,"type":"MSQ","marks":1,"question":"Which disinfectants primarily act by oxidation?","options":["Chlorine","Hydrogen peroxide","Glutaraldehyde","Phenol"],"correct":[0,1]},
  {"id":46,"type":"MSQ","marks":2,"question":"Select TRUE statements regarding sterilization validation.","options":["Biological indicators contain resistant spores","Chemical indicators directly prove sterility","Geobacillus stearothermophilus spores are used for moist heat validation","Bacillus atrophaeus spores are commonly used for dry heat/EtO validation"],"correct":[0,2,3]},
  {"id":47,"type":"MSQ","marks":2,"question":"Which statements about chemical disinfectants are correct?","options":["Alcohols are generally not sporicidal","Glutaraldehyde can act as a chemical sterilant with sufficient exposure","Quaternary ammonium compounds are generally effective against endospores","Presence of biofilm can reduce disinfectant efficacy"],"correct":[0,1,3]},
  {"id":48,"type":"MSQ","marks":2,"question":"Which statements about microbial resistance hierarchy are generally correct (from more resistant to less resistant)?","options":["Endospores are more resistant than vegetative bacteria","Mycobacteria are more resistant than enveloped viruses","Enveloped viruses are more resistant than non-enveloped viruses","Protozoan cysts can be highly resistant to disinfectants"],"correct":[0,1,3]},
  {"id":49,"type":"MSQ","marks":2,"question":"Regarding glycolysis regulation, which are correct?","options":["PFK-1 is a major regulatory enzyme","ATP generally inhibits PFK-1 in many organisms","Pyruvate kinase is generally irreversible under cellular conditions","Aldolase is the committed step of glycolysis"],"correct":[0,1,2]},
  {"id":50,"type":"MSQ","marks":2,"question":"Select correct statements about substrate-level phosphorylation.","options":["Produces ATP directly from high-energy intermediates","Occurs in glycolysis at 1,3-BPG â†’ 3-PG and PEP â†’ pyruvate","Occurs in TCA cycle at succinyl-CoA â†’ succinate","Requires oxygen directly"],"correct":[0,1,2]},
  {"id":51,"type":"MSQ","marks":2,"question":"Select correct statements about the TCA cycle (per acetyl-CoA).","options":["Produces 3 NADH","Produces 1 FADH2","Produces 2 CO2","Consumes 1 NADH"],"correct":[0,1,2]},
  {"id":52,"type":"MSQ","marks":2,"question":"Which statements about sterilization/disinfection are correct?","options":["Filtration removes microorganisms but does not kill them","Autoclaving is suitable for many culture media and instruments","Pasteurization is considered sterilization","Dry heat sterilization generally requires higher temperature/longer time than moist heat"],"correct":[0,1,3]},
  {"id":53,"type":"MSQ","marks":2,"question":"Which statements about electron carriers in central metabolism are correct?","options":["NAD+ is reduced to NADH in glycolysis","FAD is reduced to FADH2 in TCA at succinate dehydrogenase","NADH is produced in TCA at citrate synthase step","NADH and FADH2 can feed electrons into the respiratory chain"],"correct":[0,1,3]},
  {"id":54,"type":"MSQ","marks":2,"question":"Which are correct regarding microbial death kinetics under constant conditions?","options":["Log survivors vs time is often approximately linear","D-value is the time for 1-log reduction","If D = 2 min, then 6-log reduction takes 12 min","Microbial death always follows zero-order kinetics"],"correct":[0,1,2]},
  {"id":55,"type":"MSQ","marks":2,"question":"Which statements about glycolysis outputs are correct (per glucose)?","options":["Net 2 ATP are produced by substrate-level phosphorylation","2 NADH are produced","2 acetyl-CoA are produced directly in glycolysis","2 pyruvate are produced"],"correct":[0,1,3]},
  {"id":56,"type":"NAT","marks":1,"question":"If D121 = 1.5 min, how long (min) is required for a 3-log reduction at 121Â°C?","correct":4.5,"range":0},
  {"id":57,"type":"NAT","marks":1,"question":"A population decreases from 10^7 to 10^3 during a sterilization process. What is the log reduction achieved?","correct":4,"range":0},
  {"id":58,"type":"NAT","marks":1,"question":"Glycolysis net ATP yield per glucose via substrate-level phosphorylation is:","correct":2,"range":0},
  {"id":59,"type":"NAT","marks":1,"question":"Number of NADH produced per glucose in glycolysis is:","correct":2,"range":0},
  {"id":60,"type":"NAT","marks":1,"question":"Number of CO2 produced per turn of TCA cycle (per acetyl-CoA) is:","correct":2,"range":0},
  {"id":61,"type":"NAT","marks":1,"question":"Number of NADH produced per turn of TCA cycle (per acetyl-CoA) is:","correct":3,"range":0},
  {"id":62,"type":"NAT","marks":1,"question":"If Z = 10Â°C and D121 = 2 min, estimate D131 (min).","correct":0.2,"range":0},
  {"id":63,"type":"NAT","marks":1,"question":"In glycolysis, how many ATP are consumed per glucose in the investment phase?","correct":2,"range":0},
  {"id":64,"type":"NAT","marks":1,"question":"One turn of TCA cycle produces how many reduced cofactors total (NADH + FADH2) per acetyl-CoA?","correct":4,"range":0},
  {"id":65,"type":"NAT","marks":1,"question":"If a culture has 10^5 CFU and a process gives a 5-log reduction, expected survivors (CFU) are:","correct":1,"range":0},
  {"id":66,"type":"NAT","marks":2,"question":"A spore population is 10^8. D-value at a given condition is 2 min. Time (min) needed to reach an expected survivor level of 10^2 is:","correct":12,"range":0},
  {"id":67,"type":"NAT","marks":2,"question":"If D121 = 1 min and Z = 10Â°C, estimate D111 (min).","correct":10,"range":0},
  {"id":68,"type":"NAT","marks":2,"question":"Net ATP from glycolysis + TCA via substrate-level phosphorylation per glucose (ignore oxidative phosphorylation) is:","correct":4,"range":0},
  {"id":69,"type":"NAT","marks":2,"question":"Total NADH produced per glucose from glycolysis + pyruvate dehydrogenase (PDH) + TCA (full oxidation) is:","correct":10,"range":0},
  {"id":70,"type":"NAT","marks":2,"question":"If initial microbial load is 3Ã—10^6 and a process achieves 6-log reduction, expected survivors are (in CFU):","correct":3,"range":0},
  {"id":71,"type":"NAT","marks":2,"question":"For a culture with 10^6 spores, D=3 min. Time (min) for 99.9999% reduction is:","correct":18,"range":0},
  {"id":72,"type":"NAT","marks":2,"question":"In TCA cycle, per glucose fully oxidized, total CO2 produced from PDH + TCA is:","correct":6,"range":0},
  {"id":73,"type":"NAT","marks":2,"question":"If 2 moles of glucose undergo glycolysis, total moles of pyruvate formed are:","correct":4,"range":0},
  {"id":74,"type":"NAT","marks":2,"question":"Assuming each NADH yields 3 ATP and each FADH2 yields 2 ATP (older P/O ratios), theoretical ATP from 10 NADH and 2 FADH2 is:","correct":34,"range":0},
  {"id":75,"type":"NAT","marks":2,"question":"If a chemical disinfectant achieves a 3-log reduction every 5 minutes (constant D=5 min), time (min) needed for a 9-log reduction is:","correct":15,"range":0}
];

        let currentQ = 0;
        let responses = {}; 
        let status = {}; 
        let timeRemaining = TOTAL_TIME * 60;
        let timerInterval;

        window.onload = function() {
            document.getElementById('disp-user').innerText = localStorage.getItem("REC_USER_ROLE") || "Student";
            document.getElementById('disp-id').innerText = localStorage.getItem("REC_USER_ID") || "GUEST";
            questions.forEach((q, i) => status[i] = 'not-visited');
            updatePalette();  
            loadQ(0);
            startTimer();
        };

        function startTimer() {
            const display = document.getElementById('timer-display');
            if(!display) return;
            timerInterval = setInterval(() => {
                timeRemaining--;
                let m = Math.floor(timeRemaining / 60);
                let s = timeRemaining % 60;
                display.innerText = `${m}:${s < 10 ? '0'+s : s}`;
                if (timeRemaining <= 0) window.confirmSubmit();
            }, 1000);
        }

        function loadQ(idx) {
            currentQ = idx;
            const q = questions[idx];
            if (status[idx] === 'not-visited') status[idx] = 'visited';
            updatePalette();
            document.getElementById('q-num').innerText = idx + 1;
            document.getElementById('q-type').innerText = q.type;
            document.getElementById('q-marks').innerText = `+${q.marks} Mark`;
            document.getElementById('q-text').innerText = q.question;
            const box = document.getElementById('options-box');
            box.innerHTML = "";
            const saved = responses[q.id];
            
            if (q.type === 'MCQ') {
                q.options.forEach((opt, i) => {
                    const checked = saved === i ? 'checked' : '';
                    box.innerHTML += `<label><input type="radio" name="ans" value="${i}" ${checked}> ${opt}</label>`;
                });
            } else if (q.type === 'MSQ') {
                q.options.forEach((opt, i) => {
                    const checked = (Array.isArray(saved) && saved.includes(i)) ? 'checked' : '';
                    box.innerHTML += `<label><input type="checkbox" name="ans" value="${i}" ${checked}> ${opt}</label>`;
                });
            } else if (q.type === 'NAT') {
                const val = saved !== undefined ? saved : '';
                box.innerHTML += `<input type="number" class="nat-input" id="nat-val" value="${val}" placeholder="Enter Answer">`;
            }
        }

        function saveAnswer() {
            const q = questions[currentQ];
            let ans = null;
            if (q.type === 'MCQ') {
                const sel = document.querySelector('input[name="ans"]:checked');
                if (sel) ans = parseInt(sel.value);
            } else if (q.type === 'MSQ') {
                const sels = document.querySelectorAll('input[name="ans"]:checked');
                if (sels.length > 0) ans = Array.from(sels).map(c => parseInt(c.value));
            } else if (q.type === 'NAT') {
                const el = document.getElementById('nat-val');
                if (el && el.value !== "") ans = parseFloat(el.value);
            }
            if (ans !== null) { responses[q.id] = ans; if (status[currentQ] !== 'review') status[currentQ] = 'answered'; } 
            else { delete responses[q.id]; if (status[currentQ] !== 'review') status[currentQ] = 'visited'; }
            updatePalette();
        }

        function saveNext() { saveAnswer(); if (currentQ < questions.length - 1) loadQ(currentQ + 1); }
        function markReview() { saveAnswer(); status[currentQ] = responses[questions[currentQ].id] !== undefined ? 'review-ans' : 'review'; updatePalette(); if (currentQ < questions.length - 1) loadQ(currentQ + 1); }
        function nav(dir) { saveAnswer(); if (currentQ + dir >= 0 && currentQ + dir < questions.length) loadQ(currentQ + dir); }
        function updatePalette() {
            const p = document.getElementById('palette-box');
            p.innerHTML = "";
            questions.forEach((q, i) => {
                let cls = 'p-btn';
                if (i === currentQ) cls += ' active';
                if (status[i] === 'answered') cls += ' answered';
                if (status[i] === 'visited') cls += ' visited';
                if (status[i] === 'review') cls += ' review';
                if (status[i] === 'review-ans') cls += ' review-ans';
                p.innerHTML += `<div class="${cls}" onclick="jumpTo(${i})">${i + 1}</div>`;
            });
        }
        function jumpTo(i) { saveAnswer(); loadQ(i); }
        function showReviewModal() {
            saveAnswer(); 
            const grid = document.getElementById('review-grid-content');
            grid.innerHTML = "";
            questions.forEach((q, i) => {
                const isAns = responses[q.id] !== undefined;
                grid.innerHTML += `<div class="review-item ${isAns ? 'review-ans' : 'review-miss'}" onclick="document.getElementById('reviewModal').style.display='none'; loadQ(${i});"><strong>Q${i+1}</strong><br>${isAns ? 'Ans' : 'Skip'}</div>`;
            });
            document.getElementById('reviewModal').style.display = "block";
        }
        function calculateScore() {
            let score = 0, correct = 0, attempted = Object.keys(responses).length;
            questions.forEach(q => {
                const userAns = responses[q.id];
                if (userAns === undefined) return;
                let isCorrect = false;
                if (q.type === 'MCQ') isCorrect = userAns === q.correct;
                else if (q.type === 'MSQ') isCorrect = JSON.stringify(userAns.sort()) === JSON.stringify(q.correct.sort());
                else if (q.type === 'NAT') {
                    const tolerance = 1e-6;
                    isCorrect = Math.abs(userAns - q.correct) <= (q.range || tolerance);
                }
                if (isCorrect) { score += q.marks; correct++; }
            });
            return { totalScore: score, correctCount: correct, attemptCount: attempted };
        }
    </script>
</body>
</html>
